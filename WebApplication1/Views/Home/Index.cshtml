@using Microsoft.AspNet.Identity
@model ModelProject.Utilizadores
@using ModelProject;

@{
    ViewBag.Title = "Painel de Gestão";
}

@* Se estiver autenticado e a informação estiver em falta
    @Html.ActionLink("Detalhes", "Details", "Alunos", new { id = item.Aluno.numeroAluno }, new { })
*@
@if (Request.IsAuthenticated)
{
    // Se o utilizador atual existe na BD
    var CurrentUserId = User.Identity.GetUserId();
    /* SELECT * FROM Utilizadores Where UserID = CurrentUserID
     * Se não existir cria nova entrada
     */

    ProjectDBEntities db = new ProjectDBEntities();

    var user = db.Utilizadores
                    .Where(u => u.UserID == CurrentUserId)
                    .FirstOrDefault();

    if (@user == null)
    {
        <div class="jumbotron">
            <h1>Atenção @User.Identity.GetUserName()!</h1>
            <p class="lead text-danger"> Registo incompleto!</p>
            @Html.ActionLink("Editar", "Create", "Utilizadores", new { }, new { })
        </div>
    }
    else
    {
        @* Ver se o id do utilizador existe na BD,
            * Tipo admin mostrar lista de utilizadores para aceitar
            * Tipo !admin mostrar ações
        *@
        <div class="row">
            <div class="col-md-4">
                <h2>Adicionar ocorrência</h2>
                <ul>
                    <li>Pedir esclarecimentos sobre um determinado processo em aberto na Junta de Freguesia</li>
                    <li>Solicitar o agendamento de reunião com o Presidente da Junta de Freguesia</li>
                    <li>Reportar problemas na freguesia (exemplo: estradas, jardins, edifícios)</li>
                    <li>Enviar sugestões</li>
                </ul>
                @Html.ActionLink("Adicionar", "Create", "Ocorrencias", new { }, new { @class = "btn btn-success" })
            </div>
            <div class="col-md-4">
                <h2>Informações úteis</h2>
                <p>Últimas notificações.</p>
                @* Passar id do utilizador ou id da junta *@
                @Html.ActionLink("Ver", "Index", "Ocorrencias", new { }, new { @class = "btn btn-success" })
            </div>
            <div class="col-md-4">
                <h2>Web Hosting</h2>
                <p>You can easily find a web hosting company that offers the right mix of features and price for your applications.</p>
                @Html.ActionLink("Adicionar", "Create", "Ocorrencias", new { }, new { @class = "btn btn-success" })
            </div>
        </div>
    }
}

